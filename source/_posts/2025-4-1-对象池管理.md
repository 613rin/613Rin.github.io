---
title: Unityå¯¹è±¡æ± ç³»ç»Ÿ
date: 2025-3-28 11:54
update: 2025-3-29 14:00
cover: https://pic-bed-5pz.pages.dev/img/12.jpg
description: Unityå¯¹è±¡æ± ç³»ç»Ÿ
swiper_index: 13 #ç½®é¡¶è½®æ’­å›¾é¡ºåºï¼Œéè´Ÿæ•´æ•°ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰
---


# Unityå¯¹è±¡æ± æŠ€æœ¯æ·±åº¦è§£æï¼šä»åŸç†åˆ°å®æˆ˜ä¼˜åŒ–


## ä¸ºä»€ä¹ˆéœ€è¦å¯¹è±¡æ± ï¼Ÿ

åœ¨åŠ¨ä½œæ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼š
- ç©å®¶è¿ç»­å‘å°„å­å¼¹ ğŸ’¥
- æ•Œäººè¢«å‡»ä¸­æ—¶æ’­æ”¾çˆ†ç‚¸ç‰¹æ•ˆ ğŸ’£
- è§’è‰²ç§»åŠ¨æ—¶äº§ç”Ÿè„šå°ç—•è¿¹ ğŸ‘£

ä¼ ç»Ÿå®ç°æ–¹å¼ï¼š
```csharp
// é—®é¢˜ä»£ç ï¼šé¢‘ç¹å®ä¾‹åŒ–
void FireBullet() {
    Instantiate(bulletPrefab, firePosition, Quaternion.identity);
}
```

**æ€§èƒ½ç—›ç‚¹**ï¼š
1. å†…å­˜ç¢ç‰‡åŒ– ğŸ§©
2. GCï¼ˆåƒåœ¾å›æ”¶ï¼‰å‹åŠ› â±ï¸
3. å¡é¡¿é£é™© âš ï¸

## å¯¹è±¡æ± æ ¸å¿ƒæ¶æ„

### 1. æ•°æ®ç»“æ„è®¾è®¡
```mermaid
classDiagram
    class ObjectPool {
        +Dictionary<string, Queue<GameObject>> poolDict
        +Transform poolParent
        +InitializePool()
        +GetObject() GameObject
        +ReturnObject() void
    }
```

### 2. åŸºç¡€å®ç°ä»£ç 
```csharp
public class ObjectPool : MonoBehaviour {
    [System.Serializable]
    public class Pool {
        public string tag;
        public GameObject prefab;
        public int size;
    }

    public List<Pool> pools;
    public Dictionary<string, Queue<GameObject>> poolDictionary;

    void Start() {
        poolDictionary = new Dictionary<string, Queue<GameObject>>();
        
        foreach (Pool pool in pools) {
            Queue<GameObject> objectPool = new Queue<GameObject>();
            
            for (int i = 0; i < pool.size; i++) {
                GameObject obj = Instantiate(pool.prefab);
                obj.SetActive(false);
                objectPool.Enqueue(obj);
            }
            
            poolDictionary.Add(pool.tag, objectPool);
        }
    }
}
```

## å…­å¤§ä¼˜åŒ–æŠ€å·§

### 1. åŠ¨æ€æ‰©å®¹æœºåˆ¶
```csharp
public GameObject GetObject(string tag) {
    if (!poolDictionary.ContainsKey(tag)) {
        Debug.LogWarning("Pool doesn't exist!");
        return null;
    }

    if (poolDictionary[tag].Count == 0) {
        ExpandPool(tag, 5); // è‡ªåŠ¨æ‰©å®¹5ä¸ª
    }

    GameObject obj = poolDictionary[tag].Dequeue();
    obj.SetActive(true);
    return obj;
}

void ExpandPool(string tag, int amount) {
    Pool pool = pools.Find(p => p.tag == tag);
    for (int i = 0; i < amount; i++) {
        GameObject obj = Instantiate(pool.prefab);
        obj.SetActive(false);
        poolDictionary[tag].Enqueue(obj);
    }
}
```

### 2. ç”Ÿå‘½å‘¨æœŸå›è°ƒ
```csharp
public interface IPoolable {
    void OnSpawn();
    void OnDespawn();
}

// ä½¿ç”¨ç¤ºä¾‹
public class Bullet : MonoBehaviour, IPoolable {
    public void OnSpawn() {
        // é‡ç½®å­å¼¹çŠ¶æ€
    }
    
    public void OnDespawn() {
        // æ¸…ç†ç‰¹æ•ˆ
    }
}
```

### 3. å¤šå±‚æ± ç»“æ„
```mermaid
graph TD
    A[ä¸»å¯¹è±¡æ± ] --> B[å­å¼¹æ± ]
    A --> C[ç‰¹æ•ˆæ± ]
    A --> D[éŸ³æ•ˆæ± ]
    B --> B1[ç©å®¶å­å¼¹]
    B --> B2[æ•Œäººå­å¼¹]
```

## å®æˆ˜æ¡ˆä¾‹ï¼šFPSæ¸¸æˆå¼¹å£³ç³»ç»Ÿ

### å®ç°æ­¥éª¤
1. åˆ›å»ºå¼¹å£³é¢„åˆ¶ä½“ ğŸšï¸
2. é…ç½®å¯¹è±¡æ± å‚æ•°
```csharp
[Serializable]
public class ShellPool : Pool {
    public float lifeTime = 3f;
    public PhysicMaterial physicMaterial;
}
```
3. å‘å°„æ—¶è·å–å¼¹å£³
```csharp
void EjectShell() {
    GameObject shell = pool.GetObject("shell");
    shell.transform.position = ejectPosition.position;
    shell.GetComponent<Rigidbody>().AddForce(ejectForce);
    
    StartCoroutine(ReturnAfterTime(shell, pool.shellLifeTime));
}
```

## æ€§èƒ½å¯¹æ¯”æµ‹è¯•

| åœºæ™¯ | ä¼ ç»Ÿæ–¹å¼(FPS) | å¯¹è±¡æ± (FPS) | å†…å­˜å ç”¨(MB) |
|------|---------------|-------------|--------------|
| 100å‘å­å¼¹ | 42 | 60 | 120 â†’ 85 |
| 500æ¬¡çˆ†ç‚¸ | 28 | 59 | 210 â†’ 110 |

## å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

**é—®é¢˜1ï¼šå¯¹è±¡çŠ¶æ€æ®‹ç•™**
```csharp
void ResetObject(GameObject obj) {
    obj.transform.position = Vector3.zero;
    obj.GetComponent<Rigidbody>().velocity = Vector3.zero;
    // å…¶ä»–çŠ¶æ€é‡ç½®...
}
```

**é—®é¢˜2ï¼šæ± å¯¹è±¡ä¸è¶³**
- æ–¹æ¡ˆ1ï¼šåŠ¨æ€æ‰©å®¹ï¼ˆå‰æ–‡å·²å®ç°ï¼‰
- æ–¹æ¡ˆ2ï¼šå¯¹è±¡ä¼˜å…ˆçº§ç®¡ç†
```csharp
Queue<GameObject> priorityQueue = new PriorityQueue<GameObject>(
    (a, b) => a.GetComponent<PoolItem>().priority.CompareTo(b.priority)
);
```

## è¿›é˜¶æ‰©å±•æ–¹å‘

1. **è·¨åœºæ™¯æŒä¹…åŒ–æ± ** ğŸŒ‰
```csharp
DontDestroyOnLoad(poolManager);
```

2. **èµ„æºåŠ è½½ä¼˜åŒ–** ğŸš€
```csharp
IEnumerator PreloadPoolObjects() {
    foreach (var pool in pools) {
        for (int i = 0; i < pool.size; i++) {
            GameObject obj = Instantiate(Resources.Load<GameObject>(pool.path));
            yield return null; // åˆ†å¸§åŠ è½½
        }
    }
}
```

3. **å¯è§†åŒ–è°ƒè¯•å·¥å…·** ğŸ”
```csharp
[CustomEditor(typeof(ObjectPool))]
public class ObjectPoolEditor : Editor {
    public override void OnInspectorGUI() {
        // ç»˜åˆ¶æ± çŠ¶æ€å›¾è¡¨
        DrawPoolStatusChart();
    }
}
```

## æœ€ä½³å®è·µæ¸…å•

1. âœ… æ ¹æ®æ¸¸æˆéœ€æ±‚é¢„ä¼°æ± å¤§å°
2. âœ… å®ç°å¯¹è±¡çŠ¶æ€å®Œå…¨é‡ç½®
3. âœ… æ·»åŠ æ± ç›‘æ§å’Œè°ƒè¯•åŠŸèƒ½
4. âœ… è€ƒè™‘å¤šçº¿ç¨‹å®‰å…¨ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
5. âœ… æ–‡æ¡£è®°å½•æ¯ä¸ªæ± çš„ç”¨é€”

> "å¯¹è±¡æ± ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½†æ²¡æœ‰å¯¹è±¡æ± æ˜¯ä¸‡ä¸‡ä¸èƒ½çš„" â€”â€” èµ„æ·±Unityå¼€å‘è€…

---

**ğŸ“š æ¨èå­¦ä¹ èµ„æº**ï¼š
- [Unityå®˜æ–¹æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://unity.com/how-to/unity-performance-optimization)
- [Unity Asset Storeä¸­çš„é«˜çº§æ± ç³»ç»Ÿ](https://assetstore.unity.com/)

